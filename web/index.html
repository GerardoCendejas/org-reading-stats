<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <title>Org Reading Stats</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body { font-family: sans-serif; background: #f4f4f9; padding: 20px; color: #333; }
      .container { max-width: 900px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
      h1 { text-align: center; color: #2c3e50; margin-bottom: 30px; }
      .chart-box { margin-bottom: 50px; height: 350px; }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Dashboard de Lectura</h1>
      <div class="chart-box"><canvas id="historyChart"></canvas></div>
      <div class="chart-box"><canvas id="hourChart"></canvas></div>
    </div>

    <script>
      async function loadStats() {
          try {
              const response = await fetch('data.json');
              const data = await response.json();
              
              if (!data || data.length === 0) {
                  console.error("JSON vacío detectado.");
                  return;
              }

              const historyMap = {};
              const hourCounts = new Array(24).fill(0);

              data.forEach(entry => {
                  // Limpiar nombres de días (Wed, Thu...) y normalizar guiones
                  let cleanDate = entry.timestamp.replace(/[A-Za-z]{3}/g, '').trim();
                  cleanDate = cleanDate.replace(/-/g, '/');
                  const dateObj = new Date(cleanDate);
                  
                  if (!isNaN(dateObj.getTime())) {
                      // 1. Gráfico de líneas (Días)
                      const dateKey = dateObj.toISOString().split('T')[0];
      historyMap[dateKey] = (historyMap[dateKey] || 0) + 1;

      // 2. Gráfico de radar (Horas)
      if (entry.timestamp.includes(':')) {
      hourCounts[dateObj.getHours()]++;
      }
      }
      });

      const sortedDates = Object.keys(historyMap).sort();

      // Configuración de Historial
      new Chart(document.getElementById('historyChart'), {
      type: 'line',
      data: {
      labels: sortedDates,
      datasets: [{
      label: 'Papers leídos',
      data: sortedDates.map(d => historyMap[d]),
        borderColor: '#3498db',
        backgroundColor: 'rgba(52, 152, 219, 0.1)',
        fill: true,
        tension: 0.3
        }]
        },
        options: { maintainAspectRatio: false }
        });

        // Configuración de Radar
        new Chart(document.getElementById('hourChart'), {
        type: 'radar',
        data: {
        labels: Array.from({length: 24}, (_, i) => `${i}:00`),
        datasets: [{
        label: 'Intensidad horaria',
        data: hourCounts,
        backgroundColor: 'rgba(231, 76, 60, 0.2)',
        borderColor: '#e74c3c'
        }]
        },
        options: { maintainAspectRatio: false }
        });
        } catch (err) { console.error("Fallo al cargar:", err); }
	}
	loadStats();
    </script>
  </body>
</html>
